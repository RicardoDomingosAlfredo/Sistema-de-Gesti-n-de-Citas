<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro de Usuario</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="form-container container">
    <h2>Registro de Usuario</h2>

    <label for="name">Nombre Completo</label>
    <input type="text" id="name" placeholder="Ej: Esmeralda Alfredo" />

    <label for="username">Nombre de Usuario</label>
    <input type="text" id="username" placeholder="Ej: EsmeraldaA" />

    <label for="email">Correo Electrónico</label>
    <input type="email" id="email" placeholder="Ej: esmeralda@gmail.com" />

    <label for="phone">Teléfono</label>
    <input type="tel" id="phone" placeholder="Ej: +34 691555500" />

    <label for="password">Contraseña</label>
    <input type="password" id="password" placeholder="Escribe tu contraseña" />

    <label for="confirm-password">Confirmar Contraseña</label>
    <input type="password" id="confirm-password" placeholder="Confirma tu contraseña" />

    <label for="role">Seleccionar Rol</label>
    <select id="role">
      <option disabled selected>Seleccionar Rol</option>
      <option value="ciudadano">Ciudadano</option>
      <option value="funcionario">Funcionario</option>
      <option value="admin">Administrador</option>
    </select>

    <div class="checkbox-group">
      <input type="checkbox" id="terms" />
      <label for="terms">Aceptación de términos y condiciones.</label>
    </div>

    <button onclick="register()" class="btn-register">
      <i class="fas fa-user-plus"></i> Crear Cuenta
    </button>

    <div class="login-link">
      <p>¿Ya tienes cuenta? <a href="index.html">Inicia sesión aquí</a></p>
    </div>
  </div>

  <script>
  async function register() {
    const name = document.getElementById("name").value.trim();
    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm-password").value;
    const role = document.getElementById("role").value;
    const termsAccepted = document.getElementById("terms").checked;

    if (!name || !username || !email || !phone || !password || !confirmPassword || role === "Seleccionar Rol") {
      alert("Por favor, completa todos los campos.");
      return;
    }

    if (password !== confirmPassword) {
      alert("Las contraseñas no coinciden.");
      return;
    }

    if (!termsAccepted) {
      alert("Debes aceptar los términos y condiciones.");
      return;
    }

    // Enviar datos al backend
  // Modifica el fetch para capturar mejor los errores
try {
  const response = await fetch('http://localhost:3000/api/auth/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ 
      name: document.getElementById("name").value.trim(),
      username: document.getElementById("username").value.trim(),
      email: document.getElementById("email").value.trim(),
      phone: document.getElementById("phone").value.trim(),
      password: document.getElementById("password").value,
      role: document.getElementById("role").value
    })
  });

  const data = await response.json();

  if (!response.ok) {
    throw new Error(data.message || data.error || 'Error desconocido');
  }

  alert(`Usuario registrado exitosamente`);
  window.location.href = "index.html";
} catch (error) {
  console.error('Error completo:', error);
  alert(`Error: ${error.message}`);
}
  }
</script>

</body>
</html>
